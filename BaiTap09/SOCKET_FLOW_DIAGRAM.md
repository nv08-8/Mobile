# Socket.IO Chat Flow Diagram

## ğŸ“Š Luá»“ng Hoáº¡t Äá»™ng Chi Tiáº¿t

### 1. Khá»Ÿi Táº¡o Káº¿t Ná»‘i

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         KHá»I Äá»˜NG SERVER                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   node server.js         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Server láº¯ng nghe trÃªn port 3000          â”‚
         â”‚  - HTTP server: localhost:3000            â”‚
         â”‚  - Socket.IO ready                        â”‚
         â”‚  - CORS enabled                           â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ANDROID APP CONNECT                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  SocketManager.getInstance()         â”‚
              â”‚  socket = IO.socket(SERVER_URL)      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  socketManager.connect()             â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚        WebSocket Connection Established     â”‚
         â”‚                                            â”‚
         â”‚   Android App â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Server      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. User Join Chat

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Customer   â”‚                                      â”‚    Server    â”‚
â”‚   Android    â”‚                                      â”‚   Node.js    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                                      â”‚
       â”‚  emit('join', {                                     â”‚
       â”‚    userId: 'customer1',                             â”‚
       â”‚    userName: 'John',                                â”‚
       â”‚    userType: 'customer'                             â”‚
       â”‚  })                                                 â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
       â”‚                                                      â”‚
       â”‚                   Server processes:                 â”‚
       â”‚                   - LÆ°u user vÃ o Map                â”‚
       â”‚                   - Broadcast 'user_joined'         â”‚
       â”‚                   - Gá»­i 'chat_history'              â”‚
       â”‚                                                      â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚  on('chat_history', messages)                       â”‚
       â”‚                                                      â”‚
       â”‚                                                      â”‚
       â”‚                                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Manager    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   Server     â”‚
â”‚   Android    â”‚  on('user_joined', {                 â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    userId: 'customer1',              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    userName: 'John',
                    userType: 'customer'
                  })
                  
       Toast: "John joined the chat"
```

---

### 3. Send & Receive Messages

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Customer   â”‚                                      â”‚    Server    â”‚
â”‚   (John)     â”‚                                      â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                                      â”‚
       â”‚  User nháº­p tin nháº¯n: "Hello, I need help"          â”‚
       â”‚  Nháº¥n Send button                                   â”‚
       â”‚                                                      â”‚
       â”‚  emit('send_message', {                             â”‚
       â”‚    senderId: 'customer1',                           â”‚
       â”‚    senderName: 'John',                              â”‚
       â”‚    message: 'Hello, I need help',                   â”‚
       â”‚    senderType: 'customer',                          â”‚
       â”‚    timestamp: 1702896000000                         â”‚
       â”‚  })                                                 â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
       â”‚                                                      â”‚
       â”‚                   Server processes:                 â”‚
       â”‚                   - Táº¡o message object              â”‚
       â”‚                   - LÆ°u vÃ o messages array          â”‚
       â”‚                   - io.emit('new_message')          â”‚
       â”‚                   (gá»­i tá»›i Táº¤T Cáº¢ clients)          â”‚
       â”‚                                                      â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚  on('new_message', message)                         â”‚
       â”‚  â†’ Hiá»ƒn thá»‹ tin nháº¯n trong RecyclerView            â”‚
       â”‚                                                      â”‚
       â”‚                                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Manager    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   Server     â”‚
â”‚   (Sarah)    â”‚  on('new_message', message)          â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚  â†’ Hiá»ƒn thá»‹ tin nháº¯n cá»§a John
       â”‚  â†’ RecyclerView auto-scroll
       â”‚  â†’ Toast hoáº·c notification
       â”‚
```

---

### 4. Typing Indicator

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Customer   â”‚                                      â”‚    Server    â”‚
â”‚   (John)     â”‚                                      â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                                      â”‚
       â”‚  User báº¯t Ä‘áº§u gÃµ trong EditText                     â”‚
       â”‚  TextWatcher.onTextChanged()                        â”‚
       â”‚                                                      â”‚
       â”‚  emit('typing', {                                   â”‚
       â”‚    userId: 'customer1',                             â”‚
       â”‚    userName: 'John'                                 â”‚
       â”‚  })                                                 â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
       â”‚                                                      â”‚
       â”‚                   Server broadcasts:                â”‚
       â”‚                   socket.broadcast.emit()           â”‚
       â”‚                   (gá»­i tá»›i Má»ŒI NGÆ¯á»œI trá»« sender)    â”‚
       â”‚                                                      â”‚
       â”‚                                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Manager    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   Server     â”‚
â”‚   (Sarah)    â”‚  on('typing', {                      â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    userId: 'customer1',              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    userName: 'John'
                  })
       â”‚
       â”‚  â†’ Hiá»ƒn thá»‹: "John is typing..."
       â”‚
       â”‚  [Sau 1 giÃ¢y khÃ´ng gÃµ]
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Customer   â”‚                                      â”‚    Server    â”‚
â”‚   (John)     â”‚  emit('stop_typing')                 â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                              â”‚
                                                              â”‚
                                                              â–¼
                                              socket.broadcast.emit()
                                                              â”‚
                                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Manager    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   Server     â”‚
â”‚   (Sarah)    â”‚  on('stop_typing')                   â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚  â†’ áº¨n "John is typing..."
       â”‚
```

---

### 5. User Disconnect

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Customer   â”‚                                      â”‚    Server    â”‚
â”‚   (John)     â”‚                                      â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                                      â”‚
       â”‚  User táº¯t app hoáº·c máº¥t káº¿t ná»‘i                      â”‚
       â”‚  onDestroy() called                                 â”‚
       â”‚  socketManager.disconnect()                         â”‚
       â”‚                                                      â”‚
       â”œ â”€ â”€ â”€ â”€ â”€ â”€ Connection closed â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â–ºâ”‚
       â”‚                                                      â”‚
       â”‚                   Server detects:                   â”‚
       â”‚                   socket.on('disconnect')           â”‚
       â”‚                   - XÃ³a user khá»i Map               â”‚
       â”‚                   - Broadcast 'user_left'           â”‚
       â”‚                                                      â”‚
       â”‚                                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Manager    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   Server     â”‚
â”‚   (Sarah)    â”‚  on('user_left', {                   â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    userId: 'customer1',              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    userName: 'John'
                  })
       â”‚
       â”‚  â†’ Toast: "John left the chat"
       â”‚  â†’ Update UI (show offline status)
       â”‚
```

---

## ğŸ”„ Lifecycle Events Flow

```
Android Activity Lifecycle          Socket.IO Connection
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

onCreate()
    â”‚
    â”œâ”€â–º Initialize SocketManager
    â”‚   socketManager = getInstance()
    â”‚
    â”œâ”€â–º Setup Listeners
    â”‚   onNewMessage()
    â”‚   onTyping()
    â”‚   onUserJoined()
    â”‚
    â””â”€â–º Connect & Join
        socketManager.connect() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Server: Connected
        socketManager.joinChat() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Server: User Joined

onResume()
    â”‚
    â””â”€â–º Reconnect if disconnected
        socketManager.connect()

onPause()
    â”‚
    â””â”€â–º (Keep connected for background messages)

onDestroy()
    â”‚
    â”œâ”€â–º Remove Listeners
    â”‚   socketManager.removeAllListeners()
    â”‚
    â””â”€â–º Disconnect
        socketManager.disconnect() â”€â”€â”€â”€â”€â”€â”€â”€â–º Server: Disconnected
```

---

## ğŸŒ Network Communication

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          EMULATOR                                â”‚
â”‚                                                                  â”‚
â”‚   Android App                                                    â”‚
â”‚   SocketManager                                                  â”‚
â”‚   SERVER_URL = "http://10.0.2.2:3000"                          â”‚
â”‚                            â”‚                                     â”‚
â”‚                            â”‚ WebSocket                           â”‚
â”‚                            â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ 10.0.2.2 â†’ Host Machine
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            â–¼                                     â”‚
â”‚                  HOST MACHINE (Computer)                         â”‚
â”‚                                                                  â”‚
â”‚                   localhost:3000                                 â”‚
â”‚                   Node.js Server                                 â”‚
â”‚                   Socket.IO Server                               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       REAL DEVICE                                â”‚
â”‚                                                                  â”‚
â”‚   Android App                                                    â”‚
â”‚   SocketManager                                                  â”‚
â”‚   SERVER_URL = "http://192.168.1.100:3000"                     â”‚
â”‚                            â”‚                                     â”‚
â”‚                            â”‚ WebSocket                           â”‚
â”‚                            â”‚ (Same WiFi Network)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ via WiFi Router
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            â–¼                                     â”‚
â”‚                  COMPUTER (192.168.1.100)                        â”‚
â”‚                                                                  â”‚
â”‚                   192.168.1.100:3000                            â”‚
â”‚                   Node.js Server                                 â”‚
â”‚                   Socket.IO Server                               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Data Format Examples

### Message Object (JavaScript)
```javascript
{
  id: "1702896000000",
  senderId: "customer1",
  senderName: "John Doe",
  message: "Hello, I need help with my order",
  senderType: "customer",
  timestamp: 1702896000000,
  isRead: false
}
```

### Message Object (Java)
```java
ChatMessage message = new ChatMessage(
    "customer1",           // senderId
    "John Doe",           // senderName
    "Hello, I need help", // message
    1702896000000L,       // timestamp
    "customer"            // senderType
);
```

### JSON Emit Example
```java
// Android
JSONObject data = new JSONObject();
data.put("userId", "customer1");
data.put("userName", "John Doe");
data.put("userType", "customer");
socket.emit("join", data);
```

```javascript
// Server receives
socket.on('join', (data) => {
  // data = { userId: 'customer1', userName: 'John Doe', userType: 'customer' }
});
```

---

## ğŸ¯ Event Names Mapping

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SOCKET EVENTS                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Android Client          Direction          Node.js Server â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                             â”‚
â”‚  emit("join")                 â”€â”€â”€â”€â–º         on("join")     â”‚
â”‚  emit("send_message")         â”€â”€â”€â”€â–º         on("send_...")  â”‚
â”‚  emit("typing")               â”€â”€â”€â”€â–º         on("typing")   â”‚
â”‚  emit("stop_typing")          â”€â”€â”€â”€â–º         on("stop_...")  â”‚
â”‚  emit("mark_read")            â”€â”€â”€â”€â–º         on("mark_...")  â”‚
â”‚                                                             â”‚
â”‚  on("new_message")            â—„â”€â”€â”€â”€         emit("new_...")â”‚
â”‚  on("typing")                 â—„â”€â”€â”€â”€         broadcast.emit â”‚
â”‚  on("user_joined")            â—„â”€â”€â”€â”€         broadcast.emit â”‚
â”‚  on("user_left")              â—„â”€â”€â”€â”€         broadcast.emit â”‚
â”‚  on("chat_history")           â—„â”€â”€â”€â”€         emit("chat_...")â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Server Data Storage (In-Memory)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SERVER MEMORY                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  users = Map {                                               â”‚
â”‚    "socket_abc123" => {                                      â”‚
â”‚      socketId: "socket_abc123",                             â”‚
â”‚      userId: "customer1",                                    â”‚
â”‚      userName: "John Doe",                                   â”‚
â”‚      userType: "customer",                                   â”‚
â”‚      joinedAt: Date(2024-12-18T10:00:00)                    â”‚
â”‚    },                                                        â”‚
â”‚    "socket_xyz789" => {                                      â”‚
â”‚      socketId: "socket_xyz789",                             â”‚
â”‚      userId: "manager1",                                     â”‚
â”‚      userName: "Sarah Smith",                                â”‚
â”‚      userType: "manager",                                    â”‚
â”‚      joinedAt: Date(2024-12-18T10:05:00)                    â”‚
â”‚    }                                                         â”‚
â”‚  }                                                           â”‚
â”‚                                                              â”‚
â”‚  messages = [                                                â”‚
â”‚    {                                                         â”‚
â”‚      id: "1702896000000",                                    â”‚
â”‚      senderId: "customer1",                                  â”‚
â”‚      senderName: "John Doe",                                 â”‚
â”‚      message: "Hello",                                       â”‚
â”‚      senderType: "customer",                                 â”‚
â”‚      timestamp: 1702896000000,                               â”‚
â”‚      isRead: false                                           â”‚
â”‚    },                                                        â”‚
â”‚    {                                                         â”‚
â”‚      id: "1702896001000",                                    â”‚
â”‚      senderId: "manager1",                                   â”‚
â”‚      senderName: "Sarah Smith",                              â”‚
â”‚      message: "Hi! How can I help?",                         â”‚
â”‚      senderType: "manager",                                  â”‚
â”‚      timestamp: 1702896001000,                               â”‚
â”‚      isRead: false                                           â”‚
â”‚    }                                                         â”‚
â”‚    // ... (max 100 messages)                                â”‚
â”‚  ]                                                           â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Debugging Checklist

```
âœ… SERVER SIDE
   â”œâ”€ [ ] Server running (node server.js)
   â”œâ”€ [ ] Port 3000 available
   â”œâ”€ [ ] Console shows "Running on port 3000"
   â”œâ”€ [ ] Console shows "New client connected" when app connects
   â””â”€ [ ] Console shows "Message received" when sending

âœ… ANDROID SIDE
   â”œâ”€ [ ] Dependencies added (socket.io-client)
   â”œâ”€ [ ] Gradle synced successfully
   â”œâ”€ [ ] INTERNET permission added
   â”œâ”€ [ ] SERVER_URL correct (10.0.2.2 or real IP)
   â”œâ”€ [ ] SocketManager initialized
   â”œâ”€ [ ] socket.connect() called
   â””â”€ [ ] Logcat shows "Connected to server"

âœ… NETWORK
   â”œâ”€ [ ] Server and device on same network (for real device)
   â”œâ”€ [ ] Firewall allows port 3000
   â”œâ”€ [ ] Can access http://localhost:3000 in browser
   â””â”€ [ ] Emulator uses 10.0.2.2, device uses real IP

âœ… CODE
   â”œâ”€ [ ] Event names match (client and server)
   â”œâ”€ [ ] JSON format correct
   â”œâ”€ [ ] UI updates on runOnUiThread()
   â”œâ”€ [ ] Listeners set up before connect()
   â””â”€ [ ] No syntax errors
```

---

## ğŸ“ Káº¿t Luáº­n

SÆ¡ Ä‘á»“ nÃ y mÃ´ táº£ chi tiáº¿t:
- âœ… Luá»“ng khá»Ÿi táº¡o káº¿t ná»‘i
- âœ… CÃ¡ch events Ä‘Æ°á»£c gá»­i/nháº­n
- âœ… Lifecycle cá»§a Android activity
- âœ… Network communication
- âœ… Data format
- âœ… Server data storage

**Tham kháº£o file nÃ y khi implement Ä‘á»ƒ hiá»ƒu rÃµ luá»“ng hoáº¡t Ä‘á»™ng!**

